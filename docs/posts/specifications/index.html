<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Specifications Pattern | Minhaj Uddin Khan</title>
<meta name=keywords content><meta name=description content="An attempt to explain the specifications pattern from the Domain Driven Design Book"><meta name=author content="Minhaj U. Khan"><link rel=canonical href=https://minhajthekhan.github.io/posts/specifications/><meta name=google-site-verification content="XYZabc"><meta name=yandex-verification content="XYZabc"><meta name=msvalidate.01 content="XYZabc"><link crossorigin=anonymous href=/assets/css/stylesheet.fc220c15db4aef0318bbf30adc45d33d4d7c88deff3238b23eb255afdc472ca6.css integrity="sha256-/CIMFdtK7wMYu/MK3EXTPU18iN7/MjiyPrJVr9xHLKY=" rel="preload stylesheet" as=style><link rel=icon href=https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=16x16 href=https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E><link rel=icon type=image/png sizes=32x32 href=https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E><link rel=apple-touch-icon href=https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E><link rel=mask-icon href=https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://minhajthekhan.github.io/posts/specifications/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Specifications Pattern"><meta property="og:description" content="An attempt to explain the specifications pattern from the Domain Driven Design Book"><meta property="og:type" content="article"><meta property="og:url" content="https://minhajthekhan.github.io/posts/specifications/"><meta property="og:image" content="https://minhajthekhan.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-11-05T00:00:00+00:00"><meta property="article:modified_time" content="2024-11-05T00:00:00+00:00"><meta property="og:site_name" content="Minhaj Uddin Khan"><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content="https://minhajthekhan.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E"><meta name=twitter:title content="Specifications Pattern"><meta name=twitter:description content="An attempt to explain the specifications pattern from the Domain Driven Design Book"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://minhajthekhan.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Specifications Pattern","item":"https://minhajthekhan.github.io/posts/specifications/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Specifications Pattern","name":"Specifications Pattern","description":"An attempt to explain the specifications pattern from the Domain Driven Design Book","keywords":[],"articleBody":"Imagine Your company manages an inventory of lego blocks.\nOne fine day, the company gets a requirement to deliver the legos to Switzerland that are\neither red or white are of sizes 6x10 or 5x5 if they are 5x5, they must be taller than 2cm if they are 6x10, they must be shorter than 3cm not more than 8k in total You, as a software engineer in the company is tasked write an API that takes in requirements like these, and return lego shelf location so the warehouse can pack and ship.\nYou write a simple query\nSELECT shelf_location FROM legos WHERE (color = 'red' OR color = 'white') AND ((size = '6x10' AND height \u003c 2) OR (size = '5x5' AND height \u003e 3)) LIMIT 8000; and then you put that in code.\nfunc (r *repository) GetLegoShelfPositions( ctx context.Context, firstLegoDimension, secondLegoDimension entities.LegoDimension, colors []string, limit int, ) ([]string, error) { rows, err := r.db.Query(` SELECT shelf_position FROM legos WHERE color = ANY($1) AND ((size = $2 AND height \u003c $3) OR (size = $4 AND height \u003e $5)) LIMIT $6 `, colors, firstLegoDimension.Size, firstLegoDimension.Height, secondLegoDimension.Size, secondLegoDimension.Height, limit, ) if err != nil { return nil, err } defer rows.Close() positions := make([]string, 0) for rows.Next() { var shelfPosition string if err := rows.Scan(\u0026shelfPosition); err != nil { return nil, err } positions = append(positions, shelfPosition) } return positions, nil } Moment of Reflection At this point now, you’ve taken a “business” requirement, and wired them into the “repository” layer.\nWhen faced with situations where you want to query “business objects” that match a certain “criteria” - use the Specifications pattern.\nThe specification pattern is asking whether a business object satisfies a set of requirements.\nFor example, in our case of Legos that need to be shipped to Switzerland:\nswissSpecification.IsSatisfiedBy(lego) The implementation is also super simple.\nfunc (s *LegoSpecification) IsSatisfiedBy(lego entities.Lego) bool { if !slices.Contains(s.colors, lego.Color) { return false } for _, dimension := range s.dimensions { if lego.Dimensions.Equals(dimension) { return true } } return false } At this point, you can also fetch all the legos and filter them through the specification\nOR better yet, move the query, closer to the business specification\nfunc (s *LegoSpecification) AsSQL() (query string, args []any) { // Initial part of the query args = []any{s.colors} query = \"SELECT shelf_position FROM legos WHERE color = ANY($1)\" // Prepare dynamic conditions for size and height dimensionClauses := []string{} for _, dimension := range s.dimensions { sizeArg := len(args) + 1 heightArg := len(args) + 2 // Append condition for each dimension dimensionClauses = append(dimensionClauses, fmt.Sprintf(\"(size = $%d AND height \u003c $%d)\", sizeArg, heightArg)) // Append size and height values to args args = append(args, dimension.Size, dimension.Height) } if len(dimensionClauses) \u003e 0 { query += \" AND (\" + strings.Join(dimensionClauses, \" OR \") + \")\" } args = append(args, s.notMoreThan) query += fmt.Sprintf(\" LIMIT $%d\", len(args)) return query, args } And finally, you can now simple plug this specification in your “repository” layer.\nfunc (r *repository) GetLogoBySpecification(ctx context.Context, spec Specification[Lego]) ([]string, error) { query, args := spec.AsSQL() rows, err := r.db.Query(query, args...) if err != nil { return nil, err } defer rows.Close() positions := make([]string, 0) for rows.Next() { var shelfPosition string if err := rows.Scan(\u0026shelfPosition); err != nil { return nil, err } positions = append(positions, shelfPosition) } return positions, nil } Voila! All the business removed from the repository layer.\n","wordCount":"567","inLanguage":"en","image":"https://minhajthekhan.github.io/%3Clink%20or%20path%20of%20image%20for%20opengraph,%20twitter-cards%3E","datePublished":"2024-11-05T00:00:00Z","dateModified":"2024-11-05T00:00:00Z","author":[{"@type":"Person","name":"Minhaj U. Khan"}],"mainEntityOfPage":{"@type":"WebPage","@id":"https://minhajthekhan.github.io/posts/specifications/"},"publisher":{"@type":"Organization","name":"Minhaj Uddin Khan","logo":{"@type":"ImageObject","url":"https://minhajthekhan.github.io/%3Clink%20/%20abs%20url%3E"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://minhajthekhan.github.io/ accesskey=h title="Home (Alt + H)"><img src=https://minhajthekhan.github.io/apple-touch-icon.png alt aria-label=logo height=35>Home</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://minhajthekhan.github.io/about/ title=about><span>about</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://minhajthekhan.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://minhajthekhan.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Specifications Pattern</h1><div class=post-description>An attempt to explain the specifications pattern from the Domain Driven Design Book</div><div class=post-meta><span title='2024-11-05 00:00:00 +0000 UTC'>November 5, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;567 words&nbsp;·&nbsp;Minhaj U. Khan</div></header><div class=post-content><h2 id=imagine>Imagine<a hidden class=anchor aria-hidden=true href=#imagine>#</a></h2><p>Your company manages an inventory of lego blocks.</p><p>One fine day, the company gets a requirement to deliver the legos to Switzerland that are</p><ul><li>either red or white</li><li>are of sizes 6x10 or 5x5</li><li>if they are 5x5, they must be taller than 2cm</li><li>if they are 6x10, they must be shorter than 3cm</li><li>not more than 8k in total</li></ul><p>You, as a software engineer in the company is tasked write an API that takes in requirements like these, and return lego shelf location so the warehouse can pack and ship.</p><p>You write a simple query</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-sql data-lang=sql><span class=line><span class=cl><span class=k>SELECT</span><span class=w> </span><span class=n>shelf_location</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>FROM</span><span class=w> </span><span class=n>legos</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w></span><span class=k>WHERE</span><span class=w> </span><span class=p>(</span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;red&#39;</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=n>color</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;white&#39;</span><span class=p>)</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=k>AND</span><span class=w> </span><span class=p>((</span><span class=k>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;6x10&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>height</span><span class=w> </span><span class=o>&lt;</span><span class=w> </span><span class=mi>2</span><span class=p>)</span><span class=w> </span><span class=k>OR</span><span class=w> </span><span class=p>(</span><span class=k>size</span><span class=w> </span><span class=o>=</span><span class=w> </span><span class=s1>&#39;5x5&#39;</span><span class=w> </span><span class=k>AND</span><span class=w> </span><span class=n>height</span><span class=w> </span><span class=o>&gt;</span><span class=w> </span><span class=mi>3</span><span class=p>))</span><span class=w> </span><span class=k>LIMIT</span><span class=w> </span><span class=mi>8000</span><span class=p>;</span><span class=w>
</span></span></span></code></pre></div><p>and then you put that in code.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>repository</span><span class=p>)</span> <span class=nf>GetLegoShelfPositions</span><span class=p>(</span>
</span></span><span class=line><span class=cl>	<span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>firstLegoDimension</span><span class=p>,</span> <span class=nx>secondLegoDimension</span> <span class=nx>entities</span><span class=p>.</span><span class=nx>LegoDimension</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>colors</span> <span class=p>[]</span><span class=kt>string</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=nx>limit</span> <span class=kt>int</span><span class=p>,</span>
</span></span><span class=line><span class=cl><span class=p>)</span> <span class=p>([]</span><span class=kt>string</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>rows</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nf>Query</span><span class=p>(</span><span class=s>`
</span></span></span><span class=line><span class=cl><span class=s>		SELECT shelf_position
</span></span></span><span class=line><span class=cl><span class=s>		FROM legos
</span></span></span><span class=line><span class=cl><span class=s>		WHERE color = ANY($1) 
</span></span></span><span class=line><span class=cl><span class=s>		AND ((size = $2 AND height &lt; $3) OR (size = $4 AND height &gt; $5)) LIMIT $6
</span></span></span><span class=line><span class=cl><span class=s>	`</span><span class=p>,</span> <span class=nx>colors</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>firstLegoDimension</span><span class=p>.</span><span class=nx>Size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>firstLegoDimension</span><span class=p>.</span><span class=nx>Height</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>secondLegoDimension</span><span class=p>.</span><span class=nx>Size</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>secondLegoDimension</span><span class=p>.</span><span class=nx>Height</span><span class=p>,</span>
</span></span><span class=line><span class=cl>		<span class=nx>limit</span><span class=p>,</span>
</span></span><span class=line><span class=cl>	<span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>positions</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>shelfPosition</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Scan</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>shelfPosition</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>positions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>positions</span><span class=p>,</span> <span class=nx>shelfPosition</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>positions</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=moment-of-reflection>Moment of Reflection<a hidden class=anchor aria-hidden=true href=#moment-of-reflection>#</a></h2><p>At this point now, you’ve taken a <a href=https://thecodest.co/dictionary/business-logic-layer/>“business”</a> requirement, and wired them into the <a href=https://medium.com/@pererikbergman/repository-design-pattern-e28c0f3e4a30>“repository”</a> layer.</p><p><strong>When faced with situations where you want to query “business objects” that match a certain “criteria” - use the Specifications pattern.</strong></p><p>The specification pattern is asking whether a business object satisfies a set of requirements.</p><p>For example, in our case of Legos that need to be shipped to Switzerland:</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=nx>swissSpecification</span><span class=p>.</span><span class=nf>IsSatisfiedBy</span><span class=p>(</span><span class=nx>lego</span><span class=p>)</span>
</span></span></code></pre></div><p>The implementation is also super simple.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>LegoSpecification</span><span class=p>)</span> <span class=nf>IsSatisfiedBy</span><span class=p>(</span><span class=nx>lego</span> <span class=nx>entities</span><span class=p>.</span><span class=nx>Lego</span><span class=p>)</span> <span class=kt>bool</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=p>!</span><span class=nx>slices</span><span class=p>.</span><span class=nf>Contains</span><span class=p>(</span><span class=nx>s</span><span class=p>.</span><span class=nx>colors</span><span class=p>,</span> <span class=nx>lego</span><span class=p>.</span><span class=nx>Color</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>dimension</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>s</span><span class=p>.</span><span class=nx>dimensions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>lego</span><span class=p>.</span><span class=nx>Dimensions</span><span class=p>.</span><span class=nf>Equals</span><span class=p>(</span><span class=nx>dimension</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>true</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=kc>false</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>At this point, you can also fetch all the legos and filter them through
the specification</p><p>OR better yet, move the query, closer to the business specification</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>s</span> <span class=o>*</span><span class=nx>LegoSpecification</span><span class=p>)</span> <span class=nf>AsSQL</span><span class=p>()</span> <span class=p>(</span><span class=nx>query</span> <span class=kt>string</span><span class=p>,</span> <span class=nx>args</span> <span class=p>[]</span><span class=nx>any</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=c1>// Initial part of the query
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>args</span> <span class=p>=</span> <span class=p>[]</span><span class=nx>any</span><span class=p>{</span><span class=nx>s</span><span class=p>.</span><span class=nx>colors</span><span class=p>}</span> 
</span></span><span class=line><span class=cl>	<span class=nx>query</span> <span class=p>=</span> <span class=s>&#34;SELECT shelf_position FROM legos WHERE color = ANY($1)&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=c1>// Prepare dynamic conditions for size and height
</span></span></span><span class=line><span class=cl><span class=c1></span>	<span class=nx>dimensionClauses</span> <span class=o>:=</span> <span class=p>[]</span><span class=kt>string</span><span class=p>{}</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>_</span><span class=p>,</span> <span class=nx>dimension</span> <span class=o>:=</span> <span class=k>range</span> <span class=nx>s</span><span class=p>.</span><span class=nx>dimensions</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=nx>sizeArg</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>		<span class=nx>heightArg</span> <span class=o>:=</span> <span class=nb>len</span><span class=p>(</span><span class=nx>args</span><span class=p>)</span> <span class=o>+</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Append condition for each dimension
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>dimensionClauses</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>dimensionClauses</span><span class=p>,</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34;(size = $%d AND height &lt; $%d)&#34;</span><span class=p>,</span> <span class=nx>sizeArg</span><span class=p>,</span> <span class=nx>heightArg</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>		<span class=c1>// Append size and height values to args
</span></span></span><span class=line><span class=cl><span class=c1></span>		<span class=nx>args</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=nx>dimension</span><span class=p>.</span><span class=nx>Size</span><span class=p>,</span> <span class=nx>dimension</span><span class=p>.</span><span class=nx>Height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=nx>dimensionClauses</span><span class=p>)</span> <span class=p>&gt;</span> <span class=mi>0</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=nx>query</span> <span class=o>+=</span> <span class=s>&#34; AND (&#34;</span> <span class=o>+</span> <span class=nx>strings</span><span class=p>.</span><span class=nf>Join</span><span class=p>(</span><span class=nx>dimensionClauses</span><span class=p>,</span> <span class=s>&#34; OR &#34;</span><span class=p>)</span> <span class=o>+</span> <span class=s>&#34;)&#34;</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>args</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>args</span><span class=p>,</span> <span class=nx>s</span><span class=p>.</span><span class=nx>notMoreThan</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=nx>query</span> <span class=o>+=</span> <span class=nx>fmt</span><span class=p>.</span><span class=nf>Sprintf</span><span class=p>(</span><span class=s>&#34; LIMIT $%d&#34;</span><span class=p>,</span> <span class=nb>len</span><span class=p>(</span><span class=nx>args</span><span class=p>))</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>query</span><span class=p>,</span> <span class=nx>args</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>And finally, you can now simple plug this specification in your “repository” layer.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-go data-lang=go><span class=line><span class=cl><span class=kd>func</span> <span class=p>(</span><span class=nx>r</span> <span class=o>*</span><span class=nx>repository</span><span class=p>)</span> <span class=nf>GetLogoBySpecification</span><span class=p>(</span><span class=nx>ctx</span> <span class=nx>context</span><span class=p>.</span><span class=nx>Context</span><span class=p>,</span> <span class=nx>spec</span> <span class=nx>Specification</span><span class=p>[</span><span class=nx>Lego</span><span class=p>])</span> <span class=p>([]</span><span class=kt>string</span><span class=p>,</span> <span class=kt>error</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>	<span class=nx>query</span><span class=p>,</span> <span class=nx>args</span> <span class=o>:=</span> <span class=nx>spec</span><span class=p>.</span><span class=nf>AsSQL</span><span class=p>()</span>
</span></span><span class=line><span class=cl>	<span class=nx>rows</span><span class=p>,</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>r</span><span class=p>.</span><span class=nx>db</span><span class=p>.</span><span class=nf>Query</span><span class=p>(</span><span class=nx>query</span><span class=p>,</span> <span class=nx>args</span><span class=o>...</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>if</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=k>defer</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Close</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>	<span class=nx>positions</span> <span class=o>:=</span> <span class=nb>make</span><span class=p>([]</span><span class=kt>string</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=k>for</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Next</span><span class=p>()</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>		<span class=kd>var</span> <span class=nx>shelfPosition</span> <span class=kt>string</span>
</span></span><span class=line><span class=cl>		<span class=k>if</span> <span class=nx>err</span> <span class=o>:=</span> <span class=nx>rows</span><span class=p>.</span><span class=nf>Scan</span><span class=p>(</span><span class=o>&amp;</span><span class=nx>shelfPosition</span><span class=p>);</span> <span class=nx>err</span> <span class=o>!=</span> <span class=kc>nil</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>			<span class=k>return</span> <span class=kc>nil</span><span class=p>,</span> <span class=nx>err</span>
</span></span><span class=line><span class=cl>		<span class=p>}</span>
</span></span><span class=line><span class=cl>		<span class=nx>positions</span> <span class=p>=</span> <span class=nb>append</span><span class=p>(</span><span class=nx>positions</span><span class=p>,</span> <span class=nx>shelfPosition</span><span class=p>)</span>
</span></span><span class=line><span class=cl>	<span class=p>}</span>
</span></span><span class=line><span class=cl>	<span class=k>return</span> <span class=nx>positions</span><span class=p>,</span> <span class=kc>nil</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>Voila! All the business removed from the repository layer.</p></div><footer class=post-footer><ul class=post-tags></ul><nav class=paginav><a class=next href=https://minhajthekhan.github.io/posts/my-first-post/><span class=title>Next »</span><br><span>Init.</span></a></nav></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://minhajthekhan.github.io/>Minhaj Uddin Khan</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script></body></html>